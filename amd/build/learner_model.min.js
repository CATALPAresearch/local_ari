define(["require","exports","./core_modal","./sensor_viewport"],(function(e,t,o,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ETiming=t.ERuleMethod=t.EOperators=t.EMoodleContext=t.LearnerModelManager=void 0;class r{constructor(){new n.DOMVPTracker("img").get().then(e=>{console.log(e,44)}),this.checkRules()}checkRules(){new i(r.model)}update(){}}t.LearnerModelManager=r,r.model={userid:101,semester_planing:{initial_view_ms_list:0}};class i{constructor(e){this.rules=[],this.example_rules=[{Condition:[{context:"semester_planing",key:"initial_view_ms_list",value:0,operator:l.Equal}],Action:{method:a.Modal,text:"hello world",moodle_context:s.COURSE_OVERVIEW_PAGE,viewport_selector:"h3"}}],console.log("drin"),this.lm=e,this.actionQueue=[],this.moodleContext=this._determineMoodleContext(),this.moodleInstanceID=this._determineURLParameters("id"),console.log(this.moodleContext,this.moodleInstanceID),this.rules=this.example_rules,this._checkRules()}_determineMoodleContext(){let e=window.location.pathname;switch(e=e.replace("/moodle",""),e){case"/login/index.php":return s.LOGIN_PAGE;case"/":return s.HOME_PAGE;case"/user/profile.php":return s.PROFILE_PAGE;case"/user/index.php":return s.COURSE_PARTICIPANTS;case"/course/view.php":return s.COURSE_OVERVIEW_PAGE;case"/mod/page/view.php":return s.MOD_PAGE;case"/mod/assign/view.php":return s.MOD_ASSIGNMENT;case"/mod/newsmod/view.php":return s.MOD_NEWSMOD;case"/mod/quiz/view.php":return s.MOD_QUIZ;case"/mod/quiz/attempt.php":return s.MOD_QUIZ_ATTEMPT;case"/mod/quiz/summary.php":return s.MOD_QUIZ_SUMMARY;case"/mod/quiz/review.php":return s.MOD_QUIZ_REVIEW}return s.UNKNOWN}_determineURLParameters(e){let t=document.createElement("a");t.href=window.location.href;for(var o=t.search.substring(1).split("&"),n=0;n<o.length;n++){var r=o[n].split("=");if(r[0]===e)return decodeURIComponent(r[1])}return-1}_checkRules(){for(var e=0;e<this.rules.length;e++)this.evaluateConditions(this.rules[e].Condition)&&this._addToActionQueue(this.rules[e].Action)}getLearnerModelKey(e,t){return void 0!==t&&this.lm[e][t]}evaluateConditions(e){let t=!0;for(var o=0;o<e.length;o++){let n=e[o];switch(n.operator){case l.Equal:t=!(!t||this.getLearnerModelKey(n.context,n.key)!==n.value);break;default:t=!1}}return t}_addToActionQueue(e){this.actionQueue.push(e),this._processActionQueue()}_processActionQueue(){let e=this,t=this.actionQueue.filter((function(t){return t.moodle_context===e.moodleContext}));for(var o=0;o<t.length;o++)if(console.log(t[o].viewport_selector),void 0!==t[o].viewport_selector){new n.DOMVPTracker("footer",0).get().then(n=>{e._executeAction(t[o]),console.log(n)})}else this._executeAction(t[o])}_executeAction(e){switch(e.method){case a.Alert:console.log("Execute ALERT",e.text);break;case a.Modal:this.initiateModal("Hinweis",e.text),console.log("Execute MODAL",e.text);break;default:new Error("Undefined rule action executed.")}}initiateModal(e,t){let n={id:"myfield",content:{header:'<h5 class="modal-title" id="exampleModalLabel">'+e+"</h5>",body:"<p>"+t+"</p>",footer:'<button type="button" class="btn btn-secondary" data-dismiss="modal">Jetzt nicht</button>             <button type="button" class="btn btn-primary">OK, habe verstanden</button>'},options:{centerVertically:!0,show:!0,focus:!0,keyboard:!0,backdrop:!0,animate:!0,size:o.EModalSize.small,showCloseButton:!0}};new o.Modal(n)}}var s,l,a;!function(e){e[e.LOGIN_PAGE=0]="LOGIN_PAGE",e[e.HOME_PAGE=1]="HOME_PAGE",e[e.PROFILE_PAGE=2]="PROFILE_PAGE",e[e.COURSE_PARTICIPANTS=3]="COURSE_PARTICIPANTS",e[e.COURSE_OVERVIEW_PAGE=4]="COURSE_OVERVIEW_PAGE",e.MOD_PAGE="mod_page",e.MOD_ASSIGNMENT="mod_assignment",e.MOD_NEWSMOD="mod_newsmod",e.MOD_QUIZ="mod_quiz",e.MOD_QUIZ_ATTEMPT="mod_quiz_attempt",e.MOD_QUIZ_SUMMARY="mod_quiz_summary",e.MOD_QUIZ_REVIEW="mod_quiz_review",e.UNKNOWN="unknown"}(s=t.EMoodleContext||(t.EMoodleContext={})),function(e){e[e.Smaller=0]="Smaller",e[e.Bigger=1]="Bigger",e[e.Equal=2]="Equal"}(l=t.EOperators||(t.EOperators={})),function(e){e[e.Alert=0]="Alert",e[e.Modal=1]="Modal"}(a=t.ERuleMethod||(t.ERuleMethod={})),function(e){e[e.NOW=0]="NOW",e[e.ENTER_PAGE=1]="ENTER_PAGE",e[e.LOGIN=2]="LOGIN",e[e.WHEN_VISIBLE=3]="WHEN_VISIBLE",e[e.WHEN_IDLE=4]="WHEN_IDLE"}(t.ETiming||(t.ETiming={}))}));