var __awaiter=this&&this.__awaiter||function(t,e,i,n){return new(i||(i=Promise))((function(o,s){function r(t){try{h(n.next(t))}catch(t){s(t)}}function l(t){try{h(n.throw(t))}catch(t){s(t)}}function h(t){var e;t.done?o(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(r,l)}h((n=n.apply(t,e||[])).next())}))};define(["require","exports","jquery","jqueryui"],(function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.DOMVPTracker=void 0;e.DOMVPTracker=class{constructor(t,e=0){this._onEvent=()=>{window.clearTimeout(this._timer),"number"==typeof this._timeout&&(this._timer=window.setTimeout(()=>{this.get().then(t=>{this._last?!this._deepEquality(this._last,t)&&this._callback&&(this._last=t,this._callback(Object.assign({},t,{date:(new Date).getTime()}))):(this._last=t,this._callback&&this._callback(Object.assign({},t,{date:(new Date).getTime()})))})},this._timeout))};const n=i(t).get(e);this._element=n}_deepEquality(t,e){const i=Object.keys(t),n=Object.keys(e);if(i.length!==n.length)return!1;for(const n of i){const i=t[n],o=e[n],s=null!==i&&"object"==typeof i&&null!==o&&"object"==typeof o;if(s&&!this._deepEquality(i,o)||!s&&i!==o)return!1}return!0}_isHidden(){return"none"===window.getComputedStyle(this._element).display||"hidden"===window.getComputedStyle(this._element).visibility}startTracking(t,e){this._timeout=t,this._callback=e,window.removeEventListener("scroll",this._onEvent),window.addEventListener("scroll",this._onEvent),window.removeEventListener("resize",this._onEvent),window.addEventListener("resize",this._onEvent),document.documentElement.removeEventListener("DOMSubtreeModified",this._onEvent),document.documentElement.addEventListener("DOMSubtreeModified",this._onEvent)}stopTracking(){window.removeEventListener("scroll",this._onEvent),window.removeEventListener("resize",this._onEvent),document.documentElement.removeEventListener("DOMSubtreeModified",this._onEvent)}get(){return __awaiter(this,void 0,void 0,(function*(){if("object"!=typeof this._element||!(this._element instanceof HTMLElement))throw new Error("No valid HTMLElement.");const t=this._element.getBoundingClientRect(),e=window.innerWidth||document.documentElement.clientWidth,i=window.innerHeight||document.documentElement.clientHeight;let n={element:this._element,dimensions:{height:t.height,width:t.width},viewport:{width:e,height:i},position:{top:t.top,left:t.left,right:t.right,bottom:t.bottom,centerX:t.right+t.width/2,centerY:t.top+t.height/2},fullyInsideVP:t.top>=0&&t.bottom<=i&&t.left>=0&&t.right<=e,isHidden:this._isHidden(),visibility:0};if(!n.isHidden){let o=0;for(let n=0;n<Math.floor(t.height);n++){const s=t.top+n;for(let n=0;n<Math.floor(t.width);n++){const r=t.left+n;if(r>=0&&r<=e&&s>=0&&s<=i){let t=document.elementFromPoint(r,s);null!==t&&t===this._element&&o++}}}n.visibility=o/(Math.floor(t.width)*Math.floor(t.height)),n.visibility=Number(n.visibility.toFixed(2))}return n}))}}}));