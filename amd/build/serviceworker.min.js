var __awaiter=this&&this.__awaiter||function(t,e,i,r){return new(i||(i=Promise))((function(o,n){function s(t){try{h(r.next(t))}catch(t){n(t)}}function a(t){try{h(r.throw(t))}catch(t){n(t)}}function h(t){var e;t.done?o(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(s,a)}h((r=r.apply(t,e||[])).next())}))};define(["require","exports"],(function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(t,e){this._state=r.undefined,this._path=t,this._onError=e}static supported(){return __awaiter(this,void 0,void 0,(function*(){if(!navigator||!navigator.serviceWorker||!navigator.serviceWorker.register)throw Error("Browser does not support service worker.");if("https:"!==location.protocol)throw Error("Service Worker can only run with https.")}))}register(){return __awaiter(this,void 0,void 0,(function*(){if("string"!=typeof this._path||this._path.length<=0)throw Error("No valid path to javascript file.");var t=new XMLHttpRequest;if(t.open("HEAD",this._path,!1),t.send(),404!==t.status)throw Error("Javascript file for worker not found.");if(yield i.supported(),"object"==typeof this._registration)return;let e=yield navigator.serviceWorker.getRegistration(this._path);if("object"!=typeof e)throw Error("Could not find the registration of the service worker.");this._registration=e,yield this._getServiceWorker()}))}create(){return __awaiter(this,void 0,void 0,(function*(){if(yield i.supported(),"object"==typeof this._registration)return;let t=yield navigator.serviceWorker.getRegistration(this._path);if("object"!=typeof t){if(this._registration=yield navigator.serviceWorker.register(this._path),"object"!=typeof this._registration)throw new Error("Could not connect to the service worker.");yield this._getServiceWorker()}else this._registration=t}))}unregister(){return __awaiter(this,void 0,void 0,(function*(){yield this.register(),"object"==typeof this._worker&&delete this._worker,yield this._registration.unregister(),delete this._registration}))}update(){return __awaiter(this,void 0,void 0,(function*(){yield this.register(),yield this._registration.update()}))}_setState(){this._registration.installing?this._state=r.installing:this._registration.waiting?this._state=r.waiting:this._registration.active?this._state=r.active:this._state=r.undefined}getState(){return this._state}_getServiceWorker(){return __awaiter(this,void 0,void 0,(function*(){let t=this,e=function(){t._registration.installing?t._state=r.installing:t._registration.waiting?t._state=r.waiting:t._registration.active?t._state=r.active:t._state=r.undefined};if(this._registration.installing)return this._worker=this._registration.installing,this._onError&&this._worker.addEventListener("error",this._onError),this._worker.addEventListener("statechange",e),void this._setState();if(this._registration.waiting)return this._worker=this._registration.waiting,this._onError&&this._worker.addEventListener("error",this._onError),this._worker.addEventListener("statechange",e),void this._setState();if(this._registration.active)return this._worker=this._registration.active,this._onError&&this._worker.addEventListener("error",this._onError),this._worker.addEventListener("statechange",e),void this._setState();throw Error("Could not find the service worker of the registration.")}))}sendMessage(t,e){return __awaiter(this,void 0,void 0,(function*(){if("string"!=typeof t||t.length<=0)throw Error("Please enter a valid message.");yield this.register(),this._worker.postMessage(t,e)}))}addListener(t,e){return __awaiter(this,void 0,void 0,(function*(){if("function"!=typeof e)throw Error("Callback is not a function.");if("string"!=typeof t||t.length<=0)throw Error("Please enter a valid event name.");yield this.register(),this._worker.addEventListener(t,e)}))}removeListener(t,e){return __awaiter(this,void 0,void 0,(function*(){if("function"!=typeof e)throw Error("Callback is not a function.");if("string"!=typeof t||t.length<=0)throw Error("Please enter a valid event name.");yield this.register(),this._worker.removeEventListener(t,e)}))}}var r;e.default=i,function(t){t[t.installing=0]="installing",t[t.waiting=1]="waiting",t[t.active=2]="active",t[t[void 0]=3]="undefined"}(r=e.EServiceWorkerState||(e.EServiceWorkerState={}))}));